#                 分析Java I/O 工作机制

### 磁盘IO工作机制

- 标准访问文件方式

  ![1566179178192](images/1566179178192.png)
  
  ![1566179131205](images/1566179131205.png)

- 直接IO方式

  应用程序直接访问应用程序

  ![1566179242894](images/1566179242894.png)

- 同步访问文件方式（阻塞）

  ![1566179267769](images/1566179267769.png)

- 异步访问文件方式（不会阻塞等待）

  ![1566179288118](images/1566179288118.png)

- 内存映射方式

   ![1566179371224](images/1566179371224.png)

### Java访问磁盘文件

![1566179433110](images/1566179433110.png)

- Java序列化技术

  ![1566179462494](images/1566179462494.png)

### 网络I/O工作机制

- TCP状态转化（细节待研究）

  ![1566180460576](images/1566180460576.png)

- 影响网络传输的因素

![1566180521908](images/1566180521908.png)

- Java Socket工作机制

  大部分情况下，我们都是使用基于TCP/IP流套接字，它是一种稳定的通信协议。

![1566180553938](images/1566180553938.png)

- 建立通信链路

![1566180703546](images/1566180703546.png)

![1566180710310](images/1566180710310.png)

- 数据传输

![1566180749288](images/1566180749288.png)

### NIO的工作方式

- NIO相关类图

![1566181532823](images/1566181532823.png)

- Channel 核心概念：类比某种具体交通工具，汽车或者高铁。
- Selector核心概念： 比作一个车辆调度系统，负责监控每辆车的运行状态，已经出站，还在路上等。
- buffer： 比作车上的座位。

![1566181754867](images/1566181754867.png)

- 基于NIO工作方式的Socket请求的处理过程

![1566182278175](images/1566182278175.png)

- buffer的工作方式

![1566182532807](images/1566182532807.png)

![1566182543549](images/1566182543549.png)

![1566182566554](images/1566182566554.png)

- NIO的数据访问方式
  - `FileChannel.transferXXX` 减少数据从内核到用户空间的复制，数据直接在内核空间中移动，在Linux中通过sendfile系统调用。

![1566182836293](images/1566182836293.png)

![1566182846643](images/1566182846643.png)

- 同步和异步，阻塞和非阻塞组合方式分析分析

![1566183871926](images/1566183871926.png)

### NIO常用设计模式解析

- 适配器模式： 把一个类的接口变成客户端所接受的另一种接口，从而使连个接口不匹配的而无法在一起工作的两个类在一起工作。

  ![1566184334463](images/1566184334463.png)

  - java I/O中的适配器模式,比如:`InputStreamReader`

    ![1566184571324](images/1566184571324.png)

- 装饰者模式:将某个类重新装配一下。使之跟漂亮。

![1566184749373](images/1566184749373.png)

- java中运用，比如`FilterInputStream` 具体实现`BufferInputStream`

![1566184816118](images/1566184816118.png)

![1566184833011](images/1566184833011.png)

